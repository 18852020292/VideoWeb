<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Login</title>
	<link rel="icon" href="http://glorywebsdemo.com/themeforest/html/carveordering/images/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="/css/auth.css">
	<link href="/css/kefu.css" rel="stylesheet" type="text/css" />


</head>

<body>
	<div class="lowin">
		<div class="lowin-brand">
			<img src="/img/kodinger.jpg" alt="logo">
		</div>
		<div class="lowin-wrapper">
			<div class="lowin-box lowin-login">
				<div  class="lowin-box-inner" >
					<form name = "loginForm" action = "http://localhost/UserController/login" method="post">
						<p>登录账号</p>
						<div class="lowin-group" >
							<label>用户名 <a href="#" class="login-back-link">输入用户名</a></label>
							<input id="userName" type="text" autocomplete="name"  name="userName" class="lowin-input" />
						</div>
						<div class="lowin-group password-group">
							<label>密码 <a id="forget" href="#" class="forgot-link" >忘记密码</a></label>
							<input id="password" type="password" name="password" class="lowin-input">
						</div>
<!--						<div id="userMail" style="display: none" value = ""></div>-->

						<button id = "login" type="submit" class="lowin-btn login-btn">
							登录
						</button>

						<div class="text-foot">
							不存在账号? <a href="" class="register-link">注册</a>
						</div>
					</form>
				</div>
			</div>

			<div class="lowin-box lowin-register">
				<div class="lowin-box-inner">
					<div action="/UserController/register" method="post">
						<p>开始创建账号</p>
						<div class="lowin-group">
							<label>用户名</label>
							<input type="text" name="userName"  class="lowin-input">
						</div>
						<div class="lowin-group">
							<label>密码</label>
							<input type="password" name="password" class="lowin-input">
						</div>
						<input class="lowin-btn" type="submit"/>
							

						<div class="text-foot">
							已经存在账号? <a href="" class="login-link">登录</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	
		<footer class="lowin-footer">
			Design By @xiaoming
		</footer>
	</div>

	<script src="/js/auth.js"></script>
	<script src="/js/jquery.min.js"></script>
	<script>
		$(document).ready(function(){

			$("#forget").click(
					function(){
						var value = $("#userName").val();
						var userMail;
						var userData = {
							userName: value
						};
						$.ajax({
							url:'/UserController/ajaxUserMail',
							type:"POST",
							data:userData,

							success:function(data){
								userMail = data;
								if(value === ""){
									alert("请先输入用户名！");
								}
								else if(userMail==="not found user"){
									alert("未找到此用户");
									window.location.href="http://localhost";
								}
								else if(userMail==="not found user mail"){
									alert("该用户未绑定邮箱，无法找回密码！");
									window.location.href="http://localhost";
								}
							}
						});
						// if(value == ""){
						// 	alert("请先输入用户名！");
						// }

					}
			);
			$("#login").click(
					function(){
						var userName = $("#userName").val();
						var userPassword = $("#password").val();

						var userData = {
							userName: userName,
							userPassword: userPassword
						};
						var status;
						$.ajax({
							url:'/UserController/ajaxUser',
							type:"POST",
							data:userData,
							dataType: "text",
							success:function(data){
								status = data;

								let loginForm = document.forms["loginForm"];
								console.log(loginForm.action.toString());
								if (loginForm.action.toString() ==="http://localhost/UserController/login"){
								if (status === "not found user"){
									alert("未查询到此用户！");
								}
								if (status === "The account and password do not match"){
									alert("密码错误！");
								}else {
									$("#loginForm").submit();
								}

								}
							},
							error:function(data){
								console.log("error");
							}
						});

					}
			);

		}); 
		Auth.init({
			login_url: '/UserController/login',
			forgot_url: '/UserController/forget?userName='
		});
	</script>
</body>
</html>